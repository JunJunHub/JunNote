---
datetime: 2025-06-04
aliases:
  - 随笔
tags:
  - MPU
---
# 随笔记录
## MCU电视墙测试环境
4.7MCU 10.67.24.88 admin admin

监控平台
10.67.24.51
admin@kedacom

V5.2
测试环境   10.67.24.86      snZymbs4kjUE  kBQhLgPUzkha
测试账户   admin1 keda8888
超管账户   http://10.67.24.86/luban/  administrator keda8888
HDU解码卡  10.67.24.3:8080 administrator admin123
机框ID ee837d74-5875-11ef-9dae-74fe48086704
单板ID 1867372a-5876-11ef-90d4-74fe48086704


v6.0
测试环境   10.67.24.84    snZymbs4kjUE  kBQhLgPUzkha
测试账户   admin1 keda8888
超管账户   http://10.67.24.84/luban/  administrator keda8888
HDU解码卡  10.67.24.3:8080 administrator admin123
机框ID ef4b30ce-52cd-11ef-83bc-a4bf0148302b
单板ID a21a6206-52ce-11ef-b293-a4bf0148302b


电视墙通道未启用，查状态返回错误码 0 0
                  批量轮循ID分配规则


编译结束自动拷贝替换文件命令
ssh root@10.67.69.17 -p 2211 "rm /msp/mpuaps/mpuaps"
scp -P 2211 mpuaps root@10.67.69.17:/msp/mpuaps/


## 友商分布式测试环境

小鸟分布式
远程桌面：10.67.69.59 keda/2022keda
主控节点：10.67.69.60
编码节点：10.67.69.61
解码节点：10.67.69.62


淳中分布式
主控节点：10.67.24.41
编码节点：admin/123456
解码节点：2200


分布式测试环境
研发测试
Master   10.67.69.50
EdgeIn   10.67.69.22
EdgeOut  10.67.69.57

测试环境编解码器(Web默认密码admin admin123)
Master   10.67.29.98
EdgeIn   10.67.24.8  10.67.24.11  
EdgeOut  10.67.24.4  

海豚环境(安全监控)
流媒体后台   ip:2222 root/kedacom#123
海豚部署     http://10.67.29.5:8801/iomp                         admin/kedacom@123
海豚运维     https://10.67.29.5/dops/#                           admin/d@7a61nr2we7
一机一档     http://10.67.29.5/kdall-front/#login                kdall kedacom#123
统一权限     https://10.67.29.5/cloud-rbac/#login                rbac 123456
证书配置     http://10.67.29.5/ty-device-certification-front/#/  cert kedacom#123
流媒体(安全) 10.67.29.5  SDP-31777


一机一档     https://10.67.29.7/kdall-front/new/#/kdall/permissionDevice




## 欧拉系统重启网络配置服务
sudo nmcli connection reload
sudo nmcli connection up enp4s0f1

欧拉版本 sed -i 直接修改文件时如果强制断电重启, 概率会导致文件内容丢失


## 公司内部监控平台客户端
10.67.24.51 admin@kedacom kedacom@123
5号楼六楼东北角大厅1
‭



apt install libxcb-cursor0 libxcb-cursor-dev

\\10.9.0.80\stc共享服务器\软件包及工具\SDKs\RockChip\RK3588\RK3588-NVR









## 跟踪程序查找打开的动态库

strace -e open,openat,dlopen,dlsym ./your_qt_application











## 设置默认网关

ip route add default via 10.67.31.254 dev eth1 metric 100
ip route delete default via 2.1.1.254 dev eth0



## IP冲突排查

**编解码节点组件报错日志**
Jun 25 15:37:04 User local6.info netcbb_daemon: [NETCBB_PRT]:PID[12270]:TID[12273]:[ArpIpIsConflict](537): interface[eth1]:Conflicted IP[10.67.29.172] The other side MAC[04:33:89:07:03:10]
### arp、arping
arp扫描指定网段的所有设备
```shell
#!/bin/bash
# 保存为 scan_mac.sh
INTERFACE="eth1"
TARGET_MAC="04:33:89:07:03:10"

for ip in 10.67.{24,29}.{1..254}; do
  arping -c 1 -I $INTERFACE $ip >/dev/null 2>&1
  arp -n | grep -q $TARGET_MAC && {
    echo "FOUND! $ip uses $TARGET_MAC"
    exit 0
  }
done
echo "Target MAC not found in subnet"
```
### nmap
```shell
#扫描网络中指定网段的设备
nmap -sn 10.67.29.0/24
```

如果网络内有的设备禁ping，或开启了其它隐身机制，通过以上手段可能扫不到设备信息
- 关闭ARP响应
- 设备防火墙拦截，丢弃所有ARP/ICMP请求
- 隐身模式：设备仅作网络扫描不发包(如渗透测试工具)
- VLAN隔离：设备在不同的VLAN但IP配置错误

### tcpdump
在报错的设备上抓包 `tcpdump -i eth1 -nn "ether host 04:33:89:07:03:10" -w conflict.pcap &`

可以看到有个[04:33:89:07:03:10]这个设备一直在定时的发广播包，纯L2层广播；怎么确定这个设备的IP是 [10.67.29.172]
![[ip_conflict_image.png]]



## 分布式编解码盒子升小系统
#### 后门命令

update.linux 放到 /usr  
cd /usr  
dd if=update.linux of=/dev/mmcblk0p5  
dd if=update.linux of=/dev/mmcblk0p6

重启一下 uname -a 升级前后对比看下版本号是新版本就ok了

#### 串口升级

连接串口，重启设备并快速按 `Ctrl+B`，输入串口账户密码
配置设备 IP 地址(和自己的笔记本一个网段)，配置命令：
```
setenv ipaddr 172.16.192.192
setenv serverip 172.16.192.42
setenv netmask 255.255.248.0
savee
```

笔记本同步 tftpd64 共享 os.img 升级文件，串口控制台执行升级命令`sysupdate update.linux`

![[01-Work/2-kedacom/res/image-1.png]]


## 分布式显控等保测评修改
1、打开数据库 general_log                      -  日志量比较多，恢复为关闭状态
2、web上去除SSH开关按钮                        -  恢复原样，页面保留SSH开关

3、web上去除日志删除按钮                       -  不恢复，后续日志相关web上不提供删除入口
4、支持远程下载操作日志、数据库备份            -  功能做成Http接口，支持鉴权，可对外提供。实现异地备份小程序,定时下载日志。支持鉴权
5、定时备份系统日志                            -  本地备份脚本集成到版本，通过cron定期备份系统日志，同时与第四点可以一起支持异地远程备份  
6、监测关键数据被修改告警脚本(用户账户密码信息)-  集成到版本，默认不启用，通过cron定期执行脚本

7、nginx 相关漏洞修复                          -  波及分析：web预监、web全功能简要测试
8、mpuaps 业务进程使用 nginx 代理对外提供服务  -  波及分析：主控冗余、级联场景多个mpuaps通讯端口；部分接口判断客户端是否为SSL
   - V2R1B4版本之后，主服务监听端口都是默认80 443; 项目上如果需要更换端口，需要修改nginx配置文件,

9、支持配置用户密码有效期，超过有效期提示强制修改密码，默认不启用
10、支持操作日志、登陆日志查询

11、防火墙配置优化 - 待处理



V2R1B4版本同步等保测评修改：
1、web上去除了日志删除按钮  
2、nginx 相关漏洞修复
3、mpuaps 业务进程使用nginx代理对外提供服务 
    - V2R1B4版本之后，nginx代理mpuaps监听端口默认是80 443; mpuaps进程自身监听端口是9180,9181;
	- 如果升至此版本后，再进行版本回退，web默认的端口是 9180,9181(nginx配置失效了). 可通过修改config-prod.toml配置更换监听端口
4、支持配置用户密码有效期，超过有效期提示强制修改密码
5、支持查询操作日志、登陆日志










## 分布式一体化节点通道生成
4 * 视频输入  多两路视频输入 USB 采集  
2 * 音频输入

2 * 视频输出
2 * 音频输出

1、分布式设备物理端口索引 <==> 需要和nvrsrv业务测保持一致; 或者盒子业务再转成 nvrsrv 业务内部的枚举值。
   1 = HDMI1 输出
   2 = HDMI2 输出
   ...

2、分布式设备通道端口类型枚举含义(通道信息<->映射物理端口)
    +----------------+----------------+----------------+----------------+
    | 机箱号              | (端口类型)       | (槽位号)                                     |
    | (8 bits)              | (8 bits)             | (16 bits)                                     |
    +----------------+----------------+----------------+----------------+

// 01 - 64  表示32路输出通道端口类型枚举; 通过通道端口类型枚举值计算对应物理端口Idx
1 = HDMI1 音频输出
2 = HDMI1 视频输出

3 = HDMI2 音频输出
4 = HDMI2 视频输出

5 = HDMI3 音频输出
6 = HDMI3 视频输出

7 = HDMI4 视频输出 
8 = HDMI4 视频输出

....

63= HDMI32 视频输出
64= HDMI32 视频输出    phyProtIdx = 64 / 2


// 65 - 128 表示32路标准HDMI输入通道端口类型枚举;
65 = HDMI1 音频输入
66 = HDMI1 视频输入

67 = HDMI2 音频输入
68 = HDMI2 视频输入

69 = HDMI3 音频输入
70 = HDMI3 视频输入

...

127= HDMI32 音频输入
128= HDMI32 视频输入   phyProtIdx = (128 - 64) / 2






## Auditd 审计文件修改记录

// 临时添加审计规则(读、写、执行、属性修改)
sudo auditctl -w /msp/mpuaps/config/config-prod.toml -p rwxa -k mpuapscfg

// 删除审计规则
sudo auditctl -W /msp/mpuaps/config/config-prod.toml -p rwxa -k mpuapscfg

// 永久添加、删除审计规则
// 编辑配置文件
sudo vi /etc/audit/rules.d/audit.rules
// 填写规则
-w /msp/mpuaps/config/config-prod.toml -p rwxa -k mpuapscfg

// 查看审计规则
sudo auditctl -l

// 重启审计服务
sudo systemctl restart auditd


// 查看文件修改记录
sudo ausearch -k mpuapscfg -i


// 删除审计记录
rm /var/log/audit/audit.log



## 查看文件被谁打开了
lsof /opt/kafka/config/server.properties
lsof /msp/mpuaps/config/config-prod.toml

https://gitee.com/xizhazha/qml-advanced-control

https://gitee.com/han_liu_rui_admin/FluentUI


## Linux 高压缩指令
压缩率比较高的压缩命令(xz),效率较低
要使用 xz 压缩整个文件夹，需要先将文件夹打包成一个 .tar 文件（即创建一个归档文件），然后再对这个归档文件应用 xz 压缩。这是因为 xz 本身只负责压缩单个文件，而不直接处理目录结构。

tar 命令也可以与 xz 结合起来一步完成打包和压缩的过程
tar -cJf my_folder.tar.xz my_folder/
tar -xJf my_folder.tar.xz





## QT编译移植问题

https://doc.qt.io/qt-5/qtquick-virtualkeyboard-qmlmodule.html
https://doc.qt.io/qt-5/qml-qtquick-virtualkeyboard-inputengine.html
https://doc.qt.io/qt-5/qml-qtquick-virtualkeyboard-inputcontext.html
https://doc.qt.io/qt-5/qml-qtquick-virtualkeyboard-inputmethod.html

嵌入式Linux环境，系统不支持 ibus、fcitx，设备也不支持触摸屏，基于 qtquick-virtualkeyboard 实现支持通过物理键盘输入中文。

输入控制逻辑支持：
字母键	    输入拼音
空格	    确认首选词
数字键1-5	选择候选词
Backspace	删除输入
Ctrl+Space	中英文切换


QTGUI 渲染图像默认 GBM_FORMAT_ARGB8888 -> PIXEL_FORMAT_RGB_8888
RK显示进程需要设置格式为 RK_FMT_BGRA8888，设置 RK_FMT_ARGB8888 报错不支持


// EGLFS 禁用光标
export QT_QPA_EGLFS_HIDECURSOR=1

// input 调试打印
export QT_LOGGING_RULES="qt.qpa.input=true"

// kms 插件调试打印
export QT_LOGGING_RULES="qt.qpa.eglfs.kms=true"

// qhotkey 调试打印
export QT_LOGGING_RULES="logQHotkey=true"
export QT_LOGGING_RULES="QHotkey*=true"

// 同时打开多个模块调试打印
export QT_LOGGING_RULES="logQHotkey=true;qt.qpa.eglfs.kms=true;qt.qpa.input=true;"



// physical size from connector < config values < env vars

2025-03-05 08:04:04 DEBUG Selected mode 7 : 1920 x 1080 @ 60 hz for output "HDMI1" :0: 
2025-03-05 08:04:04 DEBUG Physical size is QSizeF(600, 340) mm for output "HDMI1" :0: 
2025-03-05 08:04:04 DEBUG Format is 34325258 requested_by_user = false for output "HDMI1" :0: 
2025-03-05 08:04:04 DEBUG Output "HDMI1" framebuffer size is  QSize(1920, 1080) :0: 
2025-03-05 08:04:04 DEBUG   property 0: id = 1 name = 'EDID' :0: 
2025-03-05 08:04:04 DEBUG   type is BLOB :0: 
2025-03-05 08:04:04 DEBUG   property 1: id = 2 name = 'DPMS' :0: 
2025-03-05 08:04:04 DEBUG   type is ENUM, value is 0, possible values are: :0: 


// XRGB8888
drmForMat = DRM FORMAT XRGB8888;



1、QTGUI 这边渲染图像的参数目前不知道怎么控制
    在是在接显示器的时候确定的，不知道怎么灵活切换
   
2、QTGUI 这边可以获取渲染出图像的宽、高、格式，可以通过 socket 传给 nvrsrv 业务

3、nvrsrv 显示GUI，可以通过设置图形层参数，对 GUI 图像进行缩放


Qt 的 EGLFS 平台插件时，渲染图像的宽高（即帧缓冲区的尺寸）可以通过多种方式进行配置和控制




KVMGUI 开发框架采用 QtQuick 及 Qt 封装的系统级接口，暂不考虑用 OSP。例如 QThread ...
日志组件 QDebug 或者 log4Qt https://github.com/MEONMedical/Log4Qt  https://zhuanlan.zhihu.com/p/657361483
数据库组件支持Sqllite，RK3588已编译支持对应模块
QtQuick 框架支持 i18n 多语种翻译


//js语法
https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Language_overview


HMI   -- Human Machine Interface 人机界面，侧重如何让人与及其之间的沟通和操作变得更直观、高效、友好.
UI    -- User Interface 用户界面，聚焦在美学表现、用户视觉体验
UE    -- User Experience 用户体验设计，关注的是用户使用产品过程中的整体感受
	     对于软件工程师而言，上面这些概念可以认为都是 UI、UE 设计，不必纠结区别。

Figma -- 知名的在线 UI 设计工具，貌似可以自动生成代码
		 我们用慕客

1、QtQuick + qml 开发坐席 GUI 客户端大致流程 [qml c++ js]
   -- 需求分解，功能设计
   -- UI、UE 设计
   -- 分析 Figma HMI(GUI) 模块构成
   -- 工程目录结构设计
   -- HMI 切换
   -- HMI 实现
      1、分析 HMI 元素构成
	  2、分析 HMI 布局
	  3、自定义控件
	  4、布局
   -- HMI 与 C++ 业务逻辑


汇总QT学习文档的开源项目
https://github.com/mikeroyal/Qt-Guide

qml学习
https://github.com/Furkanzmc/QML-Coding-Guide
https://www.qt.io/product/qt6/qml-book
https://github.com/qmlbook/qmlbook



Qt Quick Layouts  布局管理组件
Qt Quick Controls 控件库官方文档
https://doc.qt.io/qt-6/qtquickcontrols-index.html?spm=5176.28103460.0.0.86cc5d27eLGgbG

https://blog.csdn.net/qq_15409121/article/details/144314626



B站收费课程(没必要买)
https://www.bilibili.com/video/BV1hk2mYkE7w/?spm_id_from=333.1391.0.0&vd_source=a5dad22e3c51af843449bc470f4caca5



GitHub 开源项目
https://github.com/nuoqian-lgtm/QianWindow


Qt 编译
https://doc.embedfire.com/linux/qt/embed/zh/latest/ebf_qt/install/install_arm.html


10.67.69.23 buildroot 编译命令
make WGET_OPTS="--no-check-certificate"



eglfs_kms gbm
https://blog.csdn.net/zyy29182918/article/details/144182093


MESA - OpenGL - CMake - Qt
https://blog.csdn.net/czg13548930186/article/details/131204470#:~:text=%E6%96%87%E7%AB%A0%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%BA%86Linux%E7%8E%AF%E5%A2%83%E4%B8%AD%EF%BC%8CMesa%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%92%8C%E5%8A%A0%E8%BD%BD%E9%80%82%E5%90%88%E7%9A%84OpenGL%E9%A9%B1%E5%8A%A8%EF%BC%8C%E5%8C%85%E6%8B%AC%E7%A1%AC%E4%BB%B6%E9%A9%B1%E5%8A%A8%E5%92%8C%E8%BD%AF%E4%BB%B6%E9%A9%B1%E5%8A%A8%E5%A6%82swrast%E3%80%82%20Mesa%E9%80%9A%E8%BF%87libGL.so%E8%87%AA%E5%8A%A8%E9%80%89%E6%8B%A9%E9%80%82%E9%85%8DGPU%E7%9A%84%E9%A9%B1%E5%8A%A8%EF%BC%8C%E5%B9%B6%E5%8F%AF%E9%80%9A%E8%BF%87%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%BC%BA%E5%88%B6%E4%BD%BF%E7%94%A8%E8%BD%AF%E4%BB%B6%E9%A9%B1%E5%8A%A8%E3%80%82,GLX%E4%BD%9C%E4%B8%BAXWindowSystem%E5%92%8COpenGL%E7%9A%84%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%8F%90%E4%BE%9B%E9%97%B4%E6%8E%A5%E5%92%8C%E7%9B%B4%E6%8E%A5%E7%8A%B6%E6%80%81%E3%80%82%20%E6%AD%A4%E5%A4%96%EF%BC%8Cglxinfo%E5%B7%A5%E5%85%B7%E7%94%A8%E4%BA%8E%E6%9F%A5%E8%AF%A2%E9%A9%B1%E5%8A%A8%E8%AF%A6%E6%83%85%E5%92%8COpenGL%E7%89%B9%E6%80%A7%E3%80%82
https://zhuanlan.zhihu.com/p/11872007450
https://docs.mesa3d.org/egl.html


mail-drives
https://developer.arm.com/downloads/-/mali-drivers/user-space




// 运行 Qt 程序报错, 接上显示器或者命令行修改对应 HDMI 接口状态
open dict succeed
no screens available, assuming 24-bit colorCannot create 
window: no screens available

//运行 Qt 程序报错, 接上显示器或者命令行修改对应 HDMI 接口状态
//不外接 lvds 或者 mipi 仅用 hdmi 的话 运行 qt 需要强制打开 hdmi 输出
echo on > /sys/class/drm/card0-HDMI-A-1/status



## 已申请代码流
V5_R2:
http://172.16.6.108/svn/NVR/trunk/20160914_NVR_V5R2_Develop/NVR_VOB/
10-common
20-service
30-nms
30-nms_hisi
70-protocol
70-protocol_hisi


V7_Daily:
http://172.16.6.108/svn/NVR_V7/trunk/nvrv7/nvr_vob/
10-common
40-service
41-service_nvr
51-appext2


V7_R2B3:
http://172.16.6.108/svn/NVR_V7/branches/20190513_NVR_V7R2B3/nvr_vob/
10-common
40-service
41-serviceext2
51-appext2



V8_R1B3:
http://172.16.6.108/svn/NVR_V7/branches/20201214_NVR_V8R1B3
10-common
40-service
41-service_nvr
51-appext2



V8_R1B2:
http://172.16.6.108/svn/NVR_V7/branches/20200915_NVR_V8R1B2
10-common
40-service
41-service_nvr
51-appext2


\\172.16.0.2-------文档资料服务器 - ipc-ipc kdc-file kdm-kdm 
\\172.16.0.99------内部版本服务器 - kdm-kdm
\\172.16.16.16-----打印机-上海5F
\\10.0.0.11 - kedacom-kedacom
\\10.0.0.14 - keda-keda              //苏州打印机


--------------------------------SuZhouXianKongKaiFa-------------------------------------------------------------
//拼控微服务
http://172.16.6.108/svn/MPC/trunk/mpcv1/mpc_vob/


//显控
http://172.16.6.108/svn/MSP/trunk/mspv1/msp_vob 

http://172.16.6.108/svn/MSP/branches/20210311_MSP_V1R2B4/msp_vob


//PCSP
http://172.16.6.108/svn/PCSP/trunk/pcspv1


//上海4F海豚平台测试环境
http://172.16.119.145/dops/#/
admin
kedacom#123


10.20.132.95


//设备MSP1000
10.20.136.2  admin/admin123


//mount
sudo mount -o "username=<username>,password=<password>,uid=<uid>,gid=<gid>,dir_mode=0755,file_mode=0755,nounix,noserverino" //<host>/share /share


//mysql

//tcpdump抓包
tcpdump -i any -s 0 host 10.67.76.16 -v -w tcpdump.pcap

ulimit

k8s和docker版本对应关系查看
https://github.com/kubernetes/kubernetes/releases

Kubernetes 1.15.2  -->Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09

Kubernetes 1.15.1  -->Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09

Kubernetes 1.15.0  -->Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09

Kubernetes 1.14.5  -->Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09

Kubernetes 1.14.4  -->Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09

Kubernetes 1.14.3  -->Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09

Kubernetes 1.14.2  -->Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09

Kubernetes 1.14.1  -->Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09

Kubernetes 1.14.0  -->Docker版本1.13.1、17.03、17.06、17.09、18.06、18.09

Kubernetes 1.13.5  -->Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06

Kubernetes 1.13.5  -->Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06

Kubernetes 1.13.4  -->Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06

Kubernetes 1.13.3  -->Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06

Kubernetes 1.13.2  -->Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06

Kubernetes 1.13.1  -->Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06

Kubernetes 1.13.0  -->Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06

Kubernetes 1.12.*  -->Docker版本1.11.1、1.12.1、1.13.1、17.03、17.06、17.09、18.06

Kubernetes 1.11.*  -->Docker版本1.11.2到1.13.1、17.03

Kubernetes 1.10.*  -->Docker版本1.11.2到1.13.1、17.03